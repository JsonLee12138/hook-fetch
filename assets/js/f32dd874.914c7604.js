"use strict";(self.webpackChunkhook_fetch_docs=self.webpackChunkhook_fetch_docs||[]).push([[1997],{3237:(n,e,t)=>{t.d(e,{R:()=>c,x:()=>a});var r=t(4349);const s={},o=r.createContext(s);function c(n){const e=r.useContext(o);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:c(n.components),r.createElement(o.Provider,{value:e},n.children)}},6817:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>c,metadata:()=>r,toc:()=>l});const r=JSON.parse('{"id":"streaming","title":"\u6d41\u5f0f\u5904\u7406","description":"Hook-Fetch \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u6d41\u5f0f\u6570\u636e\u5904\u7406\u80fd\u529b\uff0c\u7279\u522b\u9002\u5408\u5904\u7406 Server-Sent Events (SSE)\u3001\u5b9e\u65f6\u6570\u636e\u6d41\u548c\u5927\u6587\u4ef6\u4f20\u8f93\u7b49\u573a\u666f\u3002","source":"@site/docs/streaming.md","sourceDirName":".","slug":"/streaming","permalink":"/hook-fetch/docs/streaming","draft":false,"unlisted":false,"tags":[],"version":"current","lastUpdatedBy":"Json_Lee","lastUpdatedAt":1751963620000,"sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"\u63d2\u4ef6\u7cfb\u7edf","permalink":"/hook-fetch/docs/plugins"},"next":{"title":"\u6846\u67b6\u96c6\u6210","permalink":"/hook-fetch/docs/framework-integration"}}');var s=t(4489),o=t(3237);const c={sidebar_position:5},a="\u6d41\u5f0f\u5904\u7406",i={},l=[{value:"\u57fa\u7840\u6d41\u5f0f\u5904\u7406",id:"\u57fa\u7840\u6d41\u5f0f\u5904\u7406",level:2},{value:"\u4f7f\u7528 stream() \u65b9\u6cd5",id:"\u4f7f\u7528-stream-\u65b9\u6cd5",level:3},{value:"StreamContext \u7ed3\u6784",id:"streamcontext-\u7ed3\u6784",level:3},{value:"Server-Sent Events (SSE)",id:"server-sent-events-sse",level:2},{value:"\u57fa\u7840 SSE \u5904\u7406",id:"\u57fa\u7840-sse-\u5904\u7406",level:3},{value:"\u4f7f\u7528 SSE \u63d2\u4ef6",id:"\u4f7f\u7528-sse-\u63d2\u4ef6",level:3},{value:"SSE \u63d2\u4ef6\u914d\u7f6e\u9009\u9879",id:"sse-\u63d2\u4ef6\u914d\u7f6e\u9009\u9879",level:3},{value:"\u5b9e\u65f6\u804a\u5929\u793a\u4f8b",id:"\u5b9e\u65f6\u804a\u5929\u793a\u4f8b",level:2},{value:"ChatGPT \u98ce\u683c\u7684\u6d41\u5f0f\u804a\u5929",id:"chatgpt-\u98ce\u683c\u7684\u6d41\u5f0f\u804a\u5929",level:3},{value:"\u81ea\u5b9a\u4e49\u804a\u5929\u6d41\u5904\u7406",id:"\u81ea\u5b9a\u4e49\u804a\u5929\u6d41\u5904\u7406",level:3},{value:"\u5927\u6587\u4ef6\u4e0b\u8f7d\u4e0e\u8fdb\u5ea6\u8ddf\u8e2a",id:"\u5927\u6587\u4ef6\u4e0b\u8f7d\u4e0e\u8fdb\u5ea6\u8ddf\u8e2a",level:2},{value:"\u5e26\u8fdb\u5ea6\u7684\u6587\u4ef6\u4e0b\u8f7d",id:"\u5e26\u8fdb\u5ea6\u7684\u6587\u4ef6\u4e0b\u8f7d",level:3},{value:"\u6d41\u5f0f\u4e0a\u4f20",id:"\u6d41\u5f0f\u4e0a\u4f20",level:3},{value:"\u5b9e\u65f6\u6570\u636e\u76d1\u63a7",id:"\u5b9e\u65f6\u6570\u636e\u76d1\u63a7",level:2},{value:"\u670d\u52a1\u5668\u72b6\u6001\u76d1\u63a7",id:"\u670d\u52a1\u5668\u72b6\u6001\u76d1\u63a7",level:3},{value:"\u65e5\u5fd7\u6d41\u5904\u7406",id:"\u65e5\u5fd7\u6d41\u5904\u7406",level:3},{value:"\u9519\u8bef\u5904\u7406\u4e0e\u91cd\u8fde",id:"\u9519\u8bef\u5904\u7406\u4e0e\u91cd\u8fde",level:2},{value:"\u81ea\u52a8\u91cd\u8fde\u673a\u5236",id:"\u81ea\u52a8\u91cd\u8fde\u673a\u5236",level:3},{value:"\u6d41\u5f0f\u9519\u8bef\u5904\u7406",id:"\u6d41\u5f0f\u9519\u8bef\u5904\u7406",level:3},{value:"\u6d41\u5f0f\u6570\u636e\u7f13\u5b58",id:"\u6d41\u5f0f\u6570\u636e\u7f13\u5b58",level:2},{value:"\u6d41\u5f0f\u7f13\u5b58\u63d2\u4ef6",id:"\u6d41\u5f0f\u7f13\u5b58\u63d2\u4ef6",level:3},{value:"\u6027\u80fd\u4f18\u5316",id:"\u6027\u80fd\u4f18\u5316",level:2},{value:"\u6d41\u5f0f\u6570\u636e\u538b\u7f29",id:"\u6d41\u5f0f\u6570\u636e\u538b\u7f29",level:3},{value:"\u6d41\u5f0f\u6570\u636e\u6279\u5904\u7406",id:"\u6d41\u5f0f\u6570\u636e\u6279\u5904\u7406",level:3}];function u(n){const e={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",p:"p",pre:"pre",...(0,o.R)(),...n.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(e.header,{children:(0,s.jsx)(e.h1,{id:"\u6d41\u5f0f\u5904\u7406",children:"\u6d41\u5f0f\u5904\u7406"})}),"\n",(0,s.jsx)(e.p,{children:"Hook-Fetch \u63d0\u4f9b\u4e86\u5f3a\u5927\u7684\u6d41\u5f0f\u6570\u636e\u5904\u7406\u80fd\u529b\uff0c\u7279\u522b\u9002\u5408\u5904\u7406 Server-Sent Events (SSE)\u3001\u5b9e\u65f6\u6570\u636e\u6d41\u548c\u5927\u6587\u4ef6\u4f20\u8f93\u7b49\u573a\u666f\u3002"}),"\n",(0,s.jsx)(e.h2,{id:"\u57fa\u7840\u6d41\u5f0f\u5904\u7406",children:"\u57fa\u7840\u6d41\u5f0f\u5904\u7406"}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528-stream-\u65b9\u6cd5",children:"\u4f7f\u7528 stream() \u65b9\u6cd5"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"import hookFetch from 'hook-fetch';\n\nconst request = hookFetch('https://api.example.com/stream');\n\nfor await (const chunk of request.stream()) {\n  console.log('Received chunk:', chunk.result);\n  console.log('Raw bytes:', chunk.source);\n  console.log('Error:', chunk.error);\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"streamcontext-\u7ed3\u6784",children:"StreamContext \u7ed3\u6784"}),"\n",(0,s.jsx)(e.p,{children:"\u6bcf\u4e2a\u6d41\u5f0f\u6570\u636e\u5757\u90fd\u5305\u542b\u4ee5\u4e0b\u4fe1\u606f\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"interface StreamContext<T = unknown> {\n  result: T;                  // \u5904\u7406\u540e\u7684\u6570\u636e\n  source: Uint8Array;         // \u539f\u59cb\u5b57\u8282\u6570\u636e\n  error: unknown | null;      // \u9519\u8bef\u4fe1\u606f\uff08\u5982\u679c\u6709\uff09\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"server-sent-events-sse",children:"Server-Sent Events (SSE)"}),"\n",(0,s.jsx)(e.h3,{id:"\u57fa\u7840-sse-\u5904\u7406",children:"\u57fa\u7840 SSE \u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"// \u7b80\u5355\u7684 SSE \u5904\u7406\nconst sseRequest = hookFetch('https://api.example.com/sse');\n\nfor await (const chunk of sseRequest.stream()) {\n  const text = new TextDecoder().decode(chunk.source);\n  console.log('SSE data:', text);\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u4f7f\u7528-sse-\u63d2\u4ef6",children:"\u4f7f\u7528 SSE \u63d2\u4ef6"}),"\n",(0,s.jsx)(e.p,{children:"Hook-Fetch \u63d0\u4f9b\u4e86\u4e13\u95e8\u7684 SSE \u63d2\u4ef6\u6765\u7b80\u5316\u5904\u7406\uff1a"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"import { sseTextDecoderPlugin } from 'hook-fetch/plugins/sse';\n\nconst api = hookFetch.create({\n  plugins: [\n    sseTextDecoderPlugin({\n      json: true,                 // \u81ea\u52a8\u89e3\u6790 JSON\n      prefix: 'data: ',          // \u79fb\u9664 \"data: \" \u524d\u7f00\n      splitSeparator: '\\n\\n',    // \u4e8b\u4ef6\u5206\u9694\u7b26\n      lineSeparator: '\\n',       // \u884c\u5206\u9694\u7b26\n      trim: true,                // \u53bb\u9664\u9996\u5c3e\u7a7a\u767d\n      doneSymbol: '[DONE]'       // \u7ed3\u675f\u6807\u8bb0\n    })\n  ]\n});\n\n// \u4f7f\u7528\u914d\u7f6e\u597d\u7684 SSE \u8bf7\u6c42\nfor await (const chunk of api.get('/sse-endpoint').stream()) {\n  console.log('Parsed SSE data:', chunk.result);\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"sse-\u63d2\u4ef6\u914d\u7f6e\u9009\u9879",children:"SSE \u63d2\u4ef6\u914d\u7f6e\u9009\u9879"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"interface SSETextDecoderPluginOptions {\n  splitSeparator: string;      // \u4e8b\u4ef6\u5206\u9694\u7b26\uff0c\u9ed8\u8ba4 '\\n\\n'\n  lineSeparator?: string;      // \u884c\u5206\u9694\u7b26\uff0c\u53ef\u9009\n  trim: boolean;               // \u662f\u5426\u53bb\u9664\u7a7a\u767d\uff0c\u9ed8\u8ba4 true\n  json: boolean;               // \u662f\u5426\u89e3\u6790 JSON\uff0c\u9ed8\u8ba4 false\n  prefix: string;              // \u8981\u79fb\u9664\u7684\u524d\u7f00\uff0c\u9ed8\u8ba4 ''\n  doneSymbol?: string;         // \u7ed3\u675f\u6807\u8bb0\uff0c\u53ef\u9009\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5b9e\u65f6\u804a\u5929\u793a\u4f8b",children:"\u5b9e\u65f6\u804a\u5929\u793a\u4f8b"}),"\n",(0,s.jsx)(e.h3,{id:"chatgpt-\u98ce\u683c\u7684\u6d41\u5f0f\u804a\u5929",children:"ChatGPT \u98ce\u683c\u7684\u6d41\u5f0f\u804a\u5929"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"import { sseTextDecoderPlugin } from 'hook-fetch/plugins/sse';\n\nconst chatApi = hookFetch.create({\n  baseURL: 'https://api.openai.com/v1',\n  headers: {\n    'Authorization': 'Bearer your-api-key',\n    'Content-Type': 'application/json'\n  },\n  plugins: [\n    sseTextDecoderPlugin({\n      json: true,\n      prefix: 'data: ',\n      doneSymbol: '[DONE]'\n    })\n  ]\n});\n\nasync function streamChat(message: string) {\n  const request = chatApi.post('/chat/completions', {\n    model: 'gpt-3.5-turbo',\n    messages: [{ role: 'user', content: message }],\n    stream: true\n  });\n\n  let fullResponse = '';\n\n  for await (const chunk of request.stream()) {\n    const delta = chunk.result?.choices?.[0]?.delta?.content;\n    if (delta) {\n      fullResponse += delta;\n      console.log('Streaming:', delta);\n      // \u66f4\u65b0 UI \u663e\u793a\n      updateChatUI(fullResponse);\n    }\n  }\n\n  return fullResponse;\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u81ea\u5b9a\u4e49\u804a\u5929\u6d41\u5904\u7406",children:"\u81ea\u5b9a\u4e49\u804a\u5929\u6d41\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const customChatPlugin = () => ({\n  name: 'custom-chat',\n  async transformStreamChunk(chunk, config) {\n    if (!chunk.error && chunk.result) {\n      try {\n        const data = JSON.parse(chunk.result);\n        // \u63d0\u53d6\u804a\u5929\u5185\u5bb9\n        const content = data.choices?.[0]?.delta?.content || '';\n        chunk.result = { content, timestamp: Date.now() };\n      } catch (error) {\n        chunk.error = error;\n      }\n    }\n    return chunk;\n  }\n});\n\nconst api = hookFetch.create({\n  plugins: [\n    sseTextDecoderPlugin({ json: true, prefix: 'data: ' }),\n    customChatPlugin()\n  ]\n});\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5927\u6587\u4ef6\u4e0b\u8f7d\u4e0e\u8fdb\u5ea6\u8ddf\u8e2a",children:"\u5927\u6587\u4ef6\u4e0b\u8f7d\u4e0e\u8fdb\u5ea6\u8ddf\u8e2a"}),"\n",(0,s.jsx)(e.h3,{id:"\u5e26\u8fdb\u5ea6\u7684\u6587\u4ef6\u4e0b\u8f7d",children:"\u5e26\u8fdb\u5ea6\u7684\u6587\u4ef6\u4e0b\u8f7d"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"async function downloadWithProgress(url: string, filename: string) {\n  const request = hookFetch(url);\n  const response = await request;\n\n  if (!response.ok) {\n    throw new Error(`Download failed: ${response.status}`);\n  }\n\n  const contentLength = response.headers.get('content-length');\n  const total = contentLength ? parseInt(contentLength, 10) : 0;\n  let loaded = 0;\n\n  const chunks: Uint8Array[] = [];\n\n  for await (const chunk of request.stream()) {\n    if (chunk.error) {\n      throw chunk.error;\n    }\n\n    chunks.push(chunk.source);\n    loaded += chunk.source.length;\n\n    // \u66f4\u65b0\u8fdb\u5ea6\n    const progress = total > 0 ? (loaded / total) * 100 : 0;\n    console.log(`Download progress: ${progress.toFixed(2)}%`);\n    updateProgressBar(progress);\n  }\n\n  // \u5408\u5e76\u6240\u6709\u5757\n  const blob = new Blob(chunks);\n\n  // \u521b\u5efa\u4e0b\u8f7d\u94fe\u63a5\n  const url = URL.createObjectURL(blob);\n  const a = document.createElement('a');\n  a.href = url;\n  a.download = filename;\n  a.click();\n  URL.revokeObjectURL(url);\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6d41\u5f0f\u4e0a\u4f20",children:"\u6d41\u5f0f\u4e0a\u4f20"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"async function uploadWithProgress(file: File, url: string) {\n  const chunkSize = 1024 * 1024; // 1MB chunks\n  const totalChunks = Math.ceil(file.size / chunkSize);\n\n  for (let i = 0; i < totalChunks; i++) {\n    const start = i * chunkSize;\n    const end = Math.min(start + chunkSize, file.size);\n    const chunk = file.slice(start, end);\n\n    const formData = new FormData();\n    formData.append('chunk', chunk);\n    formData.append('chunkIndex', i.toString());\n    formData.append('totalChunks', totalChunks.toString());\n    formData.append('filename', file.name);\n\n    await hookFetch(url, {\n      method: 'POST',\n      data: formData\n    }).json();\n\n    const progress = ((i + 1) / totalChunks) * 100;\n    console.log(`Upload progress: ${progress.toFixed(2)}%`);\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u5b9e\u65f6\u6570\u636e\u76d1\u63a7",children:"\u5b9e\u65f6\u6570\u636e\u76d1\u63a7"}),"\n",(0,s.jsx)(e.h3,{id:"\u670d\u52a1\u5668\u72b6\u6001\u76d1\u63a7",children:"\u670d\u52a1\u5668\u72b6\u6001\u76d1\u63a7"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const monitoringApi = hookFetch.create({\n  plugins: [\n    sseTextDecoderPlugin({\n      json: true,\n      prefix: 'data: '\n    })\n  ]\n});\n\nasync function monitorServerStatus() {\n  const request = monitoringApi.get('/api/monitoring/status');\n\n  for await (const chunk of request.stream()) {\n    const status = chunk.result;\n\n    if (status.type === 'cpu') {\n      updateCPUChart(status.value);\n    } else if (status.type === 'memory') {\n      updateMemoryChart(status.value);\n    } else if (status.type === 'disk') {\n      updateDiskChart(status.value);\n    }\n\n    // \u68c0\u67e5\u544a\u8b66\n    if (status.alert) {\n      showAlert(status.message);\n    }\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u65e5\u5fd7\u6d41\u5904\u7406",children:"\u65e5\u5fd7\u6d41\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const logStreamPlugin = () => ({\n  name: 'log-stream',\n  async transformStreamChunk(chunk, config) {\n    if (!chunk.error && typeof chunk.result === 'string') {\n      try {\n        // \u89e3\u6790\u65e5\u5fd7\u884c\n        const logEntry = JSON.parse(chunk.result);\n\n        // \u6dfb\u52a0\u5ba2\u6237\u7aef\u65f6\u95f4\u6233\n        logEntry.clientTimestamp = Date.now();\n\n        // \u683c\u5f0f\u5316\u65e5\u5fd7\u7ea7\u522b\n        logEntry.level = logEntry.level?.toUpperCase();\n\n        chunk.result = logEntry;\n      } catch (error) {\n        // \u5982\u679c\u4e0d\u662f JSON\uff0c\u4fdd\u6301\u539f\u6837\n        chunk.result = {\n          message: chunk.result,\n          level: 'INFO',\n          timestamp: Date.now()\n        };\n      }\n    }\n    return chunk;\n  }\n});\n\nconst logApi = hookFetch.create({\n  plugins: [\n    sseTextDecoderPlugin({ prefix: 'data: ' }),\n    logStreamPlugin()\n  ]\n});\n\nasync function streamLogs() {\n  for await (const chunk of logApi.get('/api/logs/stream').stream()) {\n    const log = chunk.result;\n\n    // \u6839\u636e\u65e5\u5fd7\u7ea7\u522b\u663e\u793a\u4e0d\u540c\u989c\u8272\n    const color = {\n      'ERROR': 'red',\n      'WARN': 'orange',\n      'INFO': 'blue',\n      'DEBUG': 'gray'\n    }[log.level] || 'black';\n\n    console.log(`%c[${log.level}] ${log.message}`, `color: ${color}`);\n\n    // \u6dfb\u52a0\u5230\u65e5\u5fd7\u663e\u793a\u533a\u57df\n    addLogToUI(log);\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u9519\u8bef\u5904\u7406\u4e0e\u91cd\u8fde",children:"\u9519\u8bef\u5904\u7406\u4e0e\u91cd\u8fde"}),"\n",(0,s.jsx)(e.h3,{id:"\u81ea\u52a8\u91cd\u8fde\u673a\u5236",children:"\u81ea\u52a8\u91cd\u8fde\u673a\u5236"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const reconnectingStreamPlugin = (maxRetries = 3, delay = 1000) => ({\n  name: 'reconnecting-stream',\n  async onError(error, config) {\n    const retryCount = config.extra?.retryCount || 0;\n\n    if (retryCount < maxRetries) {\n      console.log(`Stream connection failed, retrying... (${retryCount + 1}/${maxRetries})`);\n\n      // \u5ef6\u8fdf\u91cd\u8fde\n      await new Promise(resolve => setTimeout(resolve, delay * Math.pow(2, retryCount)));\n\n      // \u66f4\u65b0\u91cd\u8bd5\u8ba1\u6570\n      config.extra = { ...config.extra, retryCount: retryCount + 1 };\n\n      // \u91cd\u65b0\u521b\u5efa\u6d41\n      return hookFetch(config.url, config);\n    }\n\n    console.error('Stream connection failed after maximum retries');\n    return error;\n  }\n});\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6d41\u5f0f\u9519\u8bef\u5904\u7406",children:"\u6d41\u5f0f\u9519\u8bef\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"async function robustStreamProcessing() {\n  const api = hookFetch.create({\n    plugins: [\n      sseTextDecoderPlugin({ json: true }),\n      reconnectingStreamPlugin(5, 1000)\n    ]\n  });\n\n  try {\n    for await (const chunk of api.get('/api/stream').stream()) {\n      if (chunk.error) {\n        console.error('Chunk error:', chunk.error);\n        continue; // \u8df3\u8fc7\u9519\u8bef\u7684\u5757\n      }\n\n      try {\n        await processChunk(chunk.result);\n      } catch (processingError) {\n        console.error('Processing error:', processingError);\n        // \u7ee7\u7eed\u5904\u7406\u4e0b\u4e00\u4e2a\u5757\n      }\n    }\n  } catch (streamError) {\n    console.error('Stream error:', streamError);\n    // \u53ef\u4ee5\u5728\u8fd9\u91cc\u5b9e\u73b0\u91cd\u8fde\u903b\u8f91\n  }\n}\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6d41\u5f0f\u6570\u636e\u7f13\u5b58",children:"\u6d41\u5f0f\u6570\u636e\u7f13\u5b58"}),"\n",(0,s.jsx)(e.h3,{id:"\u6d41\u5f0f\u7f13\u5b58\u63d2\u4ef6",children:"\u6d41\u5f0f\u7f13\u5b58\u63d2\u4ef6"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const streamCachePlugin = (maxSize = 1000) => {\n  const cache = new Map();\n\n  return {\n    name: 'stream-cache',\n    async transformStreamChunk(chunk, config) {\n      if (!chunk.error && chunk.result) {\n        // \u7f13\u5b58\u6570\u636e\u5757\n        const key = `${config.url}_${Date.now()}`;\n        cache.set(key, chunk.result);\n\n        // \u9650\u5236\u7f13\u5b58\u5927\u5c0f\n        if (cache.size > maxSize) {\n          const firstKey = cache.keys().next().value;\n          cache.delete(firstKey);\n        }\n\n        // \u6dfb\u52a0\u7f13\u5b58\u4fe1\u606f\n        chunk.result = {\n          ...chunk.result,\n          cached: true,\n          cacheKey: key\n        };\n      }\n      return chunk;\n    }\n  };\n};\n"})}),"\n",(0,s.jsx)(e.h2,{id:"\u6027\u80fd\u4f18\u5316",children:"\u6027\u80fd\u4f18\u5316"}),"\n",(0,s.jsx)(e.h3,{id:"\u6d41\u5f0f\u6570\u636e\u538b\u7f29",children:"\u6d41\u5f0f\u6570\u636e\u538b\u7f29"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const compressionPlugin = () => ({\n  name: 'compression',\n  async beforeRequest(config) {\n    config.headers = new Headers(config.headers);\n    config.headers.set('Accept-Encoding', 'gzip, deflate, br');\n    return config;\n  },\n  async beforeStream(body, config) {\n    // \u5982\u679c\u54cd\u5e94\u88ab\u538b\u7f29\uff0c\u81ea\u52a8\u89e3\u538b\n    const contentEncoding = config.headers?.get?.('content-encoding');\n    if (contentEncoding === 'gzip') {\n      return body.pipeThrough(new DecompressionStream('gzip'));\n    }\n    return body;\n  }\n});\n"})}),"\n",(0,s.jsx)(e.h3,{id:"\u6d41\u5f0f\u6570\u636e\u6279\u5904\u7406",children:"\u6d41\u5f0f\u6570\u636e\u6279\u5904\u7406"}),"\n",(0,s.jsx)(e.pre,{children:(0,s.jsx)(e.code,{className:"language-typescript",children:"const batchProcessingPlugin = (batchSize = 10) => {\n  let batch: any[] = [];\n\n  return {\n    name: 'batch-processing',\n    async transformStreamChunk(chunk, config) {\n      if (!chunk.error) {\n        batch.push(chunk.result);\n\n        if (batch.length >= batchSize) {\n          // \u6279\u91cf\u5904\u7406\n          const processedBatch = await processBatch(batch);\n          batch = [];\n\n          chunk.result = processedBatch;\n        } else {\n          // \u6682\u4e0d\u8f93\u51fa\uff0c\u7b49\u5f85\u6279\u6b21\u5b8c\u6210\n          chunk.result = null;\n        }\n      }\n      return chunk;\n    }\n  };\n};\n"})}),"\n",(0,s.jsx)(e.p,{children:"\u6d41\u5f0f\u5904\u7406\u662f Hook-Fetch \u7684\u6838\u5fc3\u7279\u6027\u4e4b\u4e00\uff0c\u901a\u8fc7\u7075\u6d3b\u7684\u63d2\u4ef6\u7cfb\u7edf\u548c\u5f3a\u5927\u7684\u6d41\u5f0f API\uff0c\u60a8\u53ef\u4ee5\u8f7b\u677e\u5904\u7406\u5404\u79cd\u5b9e\u65f6\u6570\u636e\u573a\u666f\u3002"})]})}function h(n={}){const{wrapper:e}={...(0,o.R)(),...n.components};return e?(0,s.jsx)(e,{...n,children:(0,s.jsx)(u,{...n})}):u(n)}}}]);